function updateAddUdrDlg_userArrivalDate(){jQuery.ajax({url:editTeamSmartyData.ajaxPage,data:{action:"getUserArrivalDate",displayed_teamid:editTeamSmartyData.displayedTeamId,udrUserid:jQuery("#udrUserid").val()},type:"post",success:function(e){"SUCCESS"!==(e=JSON.parse(e)).statusMsg?(console.error(e.statusMsg),jQuery("#addUdrDlg_userArrivalDate").html("ERROR")):jQuery("#addUdrDlg_userArrivalDate").html(e.arrivalDate)},error:function(e,a,t){console.error("ERROR getUserArrivalDate errorThrown",t),jQuery(".deleteUdrErrorMsg").html("ERROR: Please contact your CodevTT administrator")}})}function removeTeamProject(e,a){var t=editTeamSmartyData.i18n_removeThisProjectFromTheTeam+"\n\n"+a;if(confirm(t)){var r=jQuery("#removeTeamProjectForm");r.find("input[name=deletedprojectid]").val(e),r.submit()}}function itemSelection_ok_callback(e){var a=jQuery.parseJSON(e),t=a.projectid;if(jQuery("#issueTooltips_proj_"+a.projectid).length)jQuery("#issueTooltips_proj_"+t+"_fields").text(a.tooltipFields);else{jQuery("#issueTooltipsTable").attr("style",""),jQuery("#noCustomTooltipsInfo").attr("style","display:none"),jQuery("#issueTooltipsTable").append(jQuery("<tr>").attr("id","issueTooltips_proj_"+t));var r=jQuery("<a>").attr("class","ui-icon").attr("href",editTeamSmartyData.page).attr("onclick","removeIssueTooltip('"+t+"','"+a.projectName+"');return false;");jQuery("#issueTooltips_proj_"+t).append(jQuery("<td>").attr("class","ui-state-error-text").attr("style","width:1em;").append(r)).append(jQuery("<td>").text(a.projectName)).append(jQuery("<td>").attr("id","issueTooltips_proj_"+t+"_fields").text(a.tooltipFields))}}function removeIssueTooltip(e,a){var t=editTeamSmartyData.i18n_removeIssueTooltipCustomisationForProject+" "+a;if(confirm(t)){var r=jQuery("#removeIssueTooltipForm");r.find("input[name=projectid]").val(e),r.submit()}}function deleteOnDutyTask(e,a){var t=editTeamSmartyData.i18n_noLongerOnDuty+"\n"+a;if(confirm(t)){var r=jQuery("#deleteAstreinteForm");r.find("input[name=deletedastreinte_id]").val(e),r.submit()}}function deleteDuration(e,a){jQuery("#dur_value").text(e),jQuery("#dur_display").text(a),jQuery("#formDeleteDuration").find("input[name=deleteValue]").val(e),jQuery("#formDeleteDuration").find("input[name=displayed_teamid]").val(document.getElementById("displayed_teamid").value),jQuery("#deleteDuration_dialog_form").dialog("open")}function addDuration(){jQuery("#formAddDuration").find("input[name=addValue]").val(document.getElementById("addValue").value),jQuery("#formAddDuration").find("input[name=addDisplay]").val(document.getElementById("addDisplay").value),jQuery("#formAddDuration").find("input[name=displayed_teamid]").val(document.getElementById("displayed_teamid").value);var e=validateAdd();0==e.length?jQuery("#formAddDuration").submit():alert(e)}function editDuration(e){var a=e.innerHTML;e.onclick=void 0;var t=e.id.replace("display","");e.innerHTML="<input type='text' value='"+a+"' style='background-color:#F3F781;' id='editDisplay"+t+"' /><a class='ui-icon' title='"+editTeamSmartyData.i18n_save+"' href='"+editTeamSmartyData.page+"' style='background:url(images/b_markAsRead.png);' onclick='updateDuration("+t+");return false;'></a>"}function updateDuration(e){jQuery("#formUpdateDuration").find("input[name=updateValue]").val(e),jQuery("#formUpdateDuration").find("input[name=updateDisplay]").val(document.getElementById("editDisplay"+e).value),jQuery("#formUpdateDuration").find("input[name=displayed_teamid]").val(document.getElementById("displayed_teamid").value);var a=validateUpdate();0==a.length?jQuery("#formUpdateDuration").submit():alert(a)}function validateAdd(){var e="",a="",t="";return e=document.forms.formAddDuration.addValue.value,a=document.forms.formAddDuration.addDisplay.value,e=e.replace(/\s+/g,""),a=a.replace(/\s+/g,""),0==e.length?t+="\n Value must be filled out.":isNaN(e)?t+="\n Value must be numeric.":((e=parseFloat(e))<0||1<e)&&(t+="\n Value must be between 0 and 1."),0==a.length&&(t+="\n Display must be filled out."),t}function validateUpdate(){var e="";return 0==document.forms.formUpdateDuration.updateDisplay.value.replace(/\s+/g,"").length&&(e+="\n Display must be filled out"),e}jQuery(document).ready(function(){"en"!=editTeamSmartyData.datepickerLocale&&jQuery.datepicker.setDefaults($.datepicker.regional[editTeamSmartyData.datepickerLocale]),jQuery("#datepicker").datepicker("setDate",editTeamSmartyData.datepickerDate),jQuery("#displayed_teamid").change(function(){jQuery("#displayTeamForm").submit()});var a=jQuery("#updateTeamInfoForm");jQuery("#btupdateTeamCreationDate").click(function(){a.find("input[name=action]").val("updateTeamCreationDate"),a.submit()}),jQuery("#bt_teamEnabled").click(function(){var e=jQuery("#cb_teamEnabled").attr("checked")?1:0;a.find("input[name=isTeamEnabled]").val(e),a.find("input[name=action]").val("setTeamEnabled"),a.submit()}),jQuery("#datepicker1").datepicker("setDate",editTeamSmartyData.datepicker1_arrivalDate),jQuery("#datepicker2").datepicker("setDate",editTeamSmartyData.datepicker2_departureDate);var t=jQuery("#addTeamMemberForm");jQuery("#btAddMember").click(function(){var e=0,a=editTeamSmartyData.i18n_someFieldsAreMissing+"\n";0==t.find("input[name=memberid]").val()&&(a+=editTeamSmartyData.i18n_teamMember+"\n",++e),0==e?(t.find("input[name=action]").val("addTeamMember"),t.submit()):alert(a)}),jQuery("#btAddMembersFrom").click(function(){var e=0,a=editTeamSmartyData.i18n_someFieldsAreMissing+"\n\n";0==t.find("input[name=f_src_teamid]").val()&&(a+=editTeamSmartyData.i18n_sourceTeam+"\n",++e),0==e?(t.find("input[name=action]").val("addMembersFrom"),t.submit()):alert(a)}),jQuery("#btAddProject").click(function(){var e=0,a=editTeamSmartyData.i18n_someFieldsAreMissing+"\n\n",t=jQuery("#addTeamProjectForm");0==t.find("input[name=addedprojectid]").val()&&(a+=editTeamSmartyData.i18n_project+"\n",++e),0==e?t.submit():alert(a)}),jQuery("#btSetGeneralPrefs").click(function(){var e=jQuery("#generalPrefsForm"),t="";jQuery(".generalPrefsItem").each(function(){var e=jQuery(this).attr("name"),a=jQuery(this).attr("checked")?1:0;t+=e+":"+a+","}),e.find("input[name=checkItems]").val(t),e.submit()}),jQuery("#btSetConsistencyChecks").click(function(){var e=jQuery("#consistencyCheckForm"),t="";jQuery(".consistencyCheckItem").each(function(){var e=jQuery(this).attr("name"),a=jQuery(this).attr("checked")?1:0;t+=e+":"+a+","}),e.find("input[name=checkItems]").val(t),e.submit()}),jQuery("#btAddAstreinte").click(function(){var e=0,a=editTeamSmartyData.i18n_someFieldsAreMissing+"\n\n",t=jQuery("#addAstreinteForm");0==t.find("input[name=addedastreinte_id]").val()&&(a+=editTeamSmartyData.i18n_inactivityTask+"\n",++e),0==e?t.submit():alert(a)}),jQuery("#tableTeamAdmin").on("click",".bt_addTeamAdmin",function(e){var a=jQuery("#cb_TeamAdminCandidates").val();0!=a&&jQuery.ajax({url:editTeamSmartyData.ajaxPage,data:{action:"addTeamAdmin",displayed_teamid:editTeamSmartyData.displayedTeamId,adminId:a},type:"post",success:function(e){if("SUCCESS"!==(e=JSON.parse(e)).statusMsg)console.error(e.statusMsg),jQuery(".addTeamAdminErrorMsg").html(e.statusMsg);else{var a=jQuery('<a align="absmiddle" >').addClass("bt_deleteTeamAdmin ui-icon pointer");jQuery("<tr>").append(jQuery('<td style="width:38px;">').addClass("ui-state-error-text").append(a),jQuery("<td>").text(e.adminName)).attr("data-adminId",e.adminId).addClass("teamAdminRow").appendTo("#tableTeamAdmin tbody"),$("#cb_TeamAdminCandidates option[value='"+e.adminId+"']").remove(),$("#cb_TeamAdminCandidates").select2("val",""),jQuery(".addTeamAdminErrorMsg").html(""),jQuery(".missingTeamAdminRow").remove()}},error:function(e,a,t){console.error("ERROR addTeamAdmin errorThrown",t),jQuery(".addTeamAdminErrorMsg").html("ERROR: Please contact your CodevTT administrator")}})}),jQuery("#tableTeamAdmin").on("click",".bt_deleteTeamAdmin",function(e){var a=jQuery(this).closest("tr.teamAdminRow").attr("data-adminId");jQuery.ajax({url:editTeamSmartyData.ajaxPage,data:{action:"deleteTeamAdmin",displayed_teamid:editTeamSmartyData.displayedTeamId,adminId:a},type:"post",success:function(e){if("SUCCESS"!==(e=JSON.parse(e)).statusMsg)console.error(e.statusMsg),jQuery(".deleteTeamAdminErrorMsg").html(e.statusMsg);else{jQuery(".teamAdminRow[data-adminId='"+e.adminId+"']").remove();e={id:e.adminId,text:e.adminName};var a=new Option(e.text,e.id,!1,!1);$("#cb_TeamAdminCandidates").append(a).trigger("change"),jQuery(".deleteTeamAdminErrorMsg").html("")}},error:function(e,a,t){console.error("ERROR deleteTeamAdmin errorThrown",t),jQuery(".deleteTeamAdminErrorMsg").html("ERROR: Please contact your CodevTT administrator")}})}),jQuery("#deleteDuration_dialog_form").dialog({autoOpen:!1,resizable:!0,width:"auto",modal:!0,buttons:[{text:editTeamSmartyData.i18n_delete,click:function(){jQuery("#formDeleteDuration").submit()}},{text:editTeamSmartyData.i18n_cancel,click:function(){jQuery(this).dialog("close")}}]}),jQuery("#udrUserid").change(function(){updateAddUdrDlg_userArrivalDate()}),jQuery(".btAddUserDailyCost").click(function(){jQuery(".addUdrErrorMsg").html(""),updateAddUdrDlg_userArrivalDate(),jQuery(".dialogAddUserDailyCost").dialog("open")}),jQuery(".dialogAddUserDailyCost").dialog({autoOpen:!1,resizable:!0,width:"auto",modal:!0,create:function(){$(this).closest(".ui-dialog").find(".ui-button:first").addClass("btAddUserDailyCost")},buttons:[{text:editTeamSmartyData.i18n_add,click:function(){var e=$("#formAddUserDailyCost");jQuery(".addUdrErrorMsg").html(""),$.ajax({url:editTeamSmartyData.ajaxPage,type:e.attr("method"),dataType:"json",data:e.serialize(),success:function(e){if(null===e)jQuery(".addUdrErrorMsg").html("ERROR: Please contact your CodevTT administrator");else if("SUCCESS"!==e.statusMsg)jQuery(".addUdrErrorMsg").html(e.statusMsg);else{var a=jQuery('<a align="absmiddle" >').addClass("bt_deleteUDC ui-icon pointer");jQuery("<tr>").append(jQuery('<td style="width:38px;">').addClass("ui-state-error-text").append(a),jQuery("<td>").text(e.udrStruct.userName),jQuery("<td>").text(e.udrStruct.startDate),jQuery("<td>").text(e.udrStruct.udr+" "+e.udrStruct.currency),jQuery("<td>").text(e.udrStruct.description)).attr("data-udrId",e.udrStruct.id).addClass("udrRow").prependTo("#tableUserDailyCosts tbody"),jQuery(".addUdrErrorMsg").html(""),jQuery(".dialogAddUserDailyCost").dialog("close")}},error:function(e,a,t){console.error("ERROR AddUserDailyCost errorThrown",t),jQuery(".addUdrErrorMsg").html("ERROR: Please contact your CodevTT administrator")}})}},{text:editTeamSmartyData.i18n_cancel,click:function(){jQuery(".addDashboardErrorMsg").html(""),jQuery(this).dialog("close")}}]}),jQuery("#tableUserDailyCosts").on("click",".bt_deleteUDC",function(e){var a=jQuery(this).closest("tr.udrRow").attr("data-udrId");jQuery(".deleteUdrErrorMsg").html(""),jQuery.ajax({url:editTeamSmartyData.ajaxPage,async:!1,data:{action:"deleteUDC",displayed_teamid:editTeamSmartyData.displayedTeamId,udrId:a},type:"post",success:function(e){"SUCCESS"!==(e=JSON.parse(e)).statusMsg?(console.log(e.statusMsg),jQuery(".deleteUdrErrorMsg").html("ERROR: Failed to remove UDC")):jQuery(".udrRow[data-udrId='"+e.udrId+"']").remove()},error:function(e,a,t){console.error("ERROR AddUserDailyCost errorThrown",t),jQuery(".deleteUdrErrorMsg").html("ERROR: Please contact your CodevTT administrator")}})}),jQuery("#btUpdateTeamADR").click(function(){var e=$("#formTeamADR");jQuery(".updateTeamAdrInfoMsg").html(""),jQuery(".updateTeamAdrErrorMsg").html(""),$.ajax({url:editTeamSmartyData.ajaxPage,type:e.attr("method"),dataType:"json",data:e.serialize(),success:function(e){null===e?jQuery(".updateTeamAdrErrorMsg").html("ERROR: Please contact your CodevTT administrator"):"SUCCESS"!==e.statusMsg?jQuery(".updateTeamAdrErrorMsg").html(e.statusMsg):(jQuery(".updateTeamAdrInfoMsg").html(editTeamSmartyData.i18n_updatedSuccessfully),$(".displayedTeamCurrency").html(e.teamCurrency))},error:function(e){console.error("ERROR data = ",e),jQuery(".updateTeamAdrErrorMsg").html("UpdateTeamADR ERROR!")}})}),jQuery(".teamAdrHelpDialog_link").click(function(e){e.preventDefault(),jQuery(".teamAdrHelpDialog").dialog("open")}),jQuery(".teamAdrHelpDialog").dialog({autoOpen:!1,resizable:!0,width:"auto",hide:"fade"}),jQuery(".currencyHelpDialog_link").click(function(e){e.preventDefault(),jQuery(".currencyHelpDialog").dialog("open")}),jQuery(".currencyHelpDialog").dialog({autoOpen:!1,resizable:!0,width:"auto",hide:"fade"}),jQuery(".removeTeamMember_link").click(function(e){e.preventDefault();var a=$(this).parents(".teamMembers_tr"),t=$(a).attr("data-rowId"),r=$(a).children(".teamMember_realname").text(),d=editTeamSmartyData.i18n_removeUserFromThisTeam+"\n\n"+r;confirm(d)&&$.ajax({url:editTeamSmartyData.ajaxPage,type:"POST",dataType:"json",data:{action:"removeTeamMember",displayed_teamid:editTeamSmartyData.displayedTeamId,removeMemberRowId:t},success:function(e){null===e?(console.error("ERROR removeTeamMember: no data"),alert("ERROR: Please contact your CodevTT administrator")):"SUCCESS"!==e.statusMsg?(console.error("ERROR Ajax statusMsg",e.statusMsg),alert(e.statusMsg)):jQuery(".teamMembers_tr[data-rowId='"+e.rowId+"']").remove()},error:function(e,a,t){console.error("ERROR removeTeamMember errorThrown",t)}})}),jQuery(".editTeamMember_link").click(function(e){e.preventDefault();var a=$(this).parents(".teamMembers_tr"),t=$(a).attr("data-teamMemberId"),r=$(a).children(".teamMember_realname").text(),d=$(a).children(".teamMember_arrivalDate").text(),i=$(a).children(".teamMember_departureDate").text(),n=$(a).children(".teamMember_role").attr("data-roleId");console.log(t,r,d,i,n),jQuery("#editTeamMember_dialog").dialog("option","title",r),jQuery("#editTeamMemberDlg_userId").text(t),jQuery("#editTeamMemberDlg_arrivalDate").datepicker("setDate",d),jQuery("#editTeamMemberDlg_departureDate").datepicker("setDate",i),jQuery("#editTeamMemberDlg_select_role").val(n),jQuery("#editTeamMember_dialog").dialog("open")}),jQuery("#editTeamMember_dialog").dialog({autoOpen:!1,resizable:!0,height:"auto",width:400,modal:!0,buttons:[{text:editTeamSmartyData.i18n_update,click:function(){$.ajax({url:editTeamSmartyData.ajaxPage,type:"POST",dataType:"json",data:{action:"editTeamMember",displayed_teamid:editTeamSmartyData.displayedTeamId,userId:$("#editTeamMemberDlg_userId").text(),arrivalDate:$("#editTeamMemberDlg_arrivalDate").val(),departureDate:$("#editTeamMemberDlg_departureDate").val(),accessLevelId:$("#editTeamMemberDlg_select_role option:selected").val()},success:function(e){if("SUCCESS"===e.statusMsg){var a=$(".teamMembers_tr[data-teamMemberId="+e.userId+"]");a.find(".teamMember_arrivalDate").html(e.arrivalDate),a.find(".teamMember_departureDate").html(e.departureDate),a.find(".teamMember_role").html(e.accessLevel),a.find(".teamMember_role").attr("data-roleId",e.accessLevelId)}else console.error("Ajax statusMsg",e.statusMsg),alert(e.statusMsg)},error:function(e,a,t){console.error(a,t),alert("ERROR: Please contact your CodevTT administrator")}}),jQuery(this).dialog("close")}},{text:editTeamSmartyData.i18n_cancel,click:function(){jQuery(this).dialog("close")}}]})});